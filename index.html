<link rel="stylesheet" href="style.css">

<body>
  <svg id="svg" width="2000px" height="2000px" style="background-color: #111;">
    <defs>
      <path id="ship" d="M 1 0 L -1 1 L -1 -1 Z" fill="green" stroke="black" vector-effect="non-scaling-stroke"></path>
    </defs>
    <g id="stars"></g>
  </svg>
</body>

<script type="module">

  import { Ship } from './src/ship.js';

  const SVGNS = 'http://www.w3.org/2000/svg';

  // Create starfield
  const stars = document.getElementById( 'stars' );
  for ( let i = 0; i < 300; i ++ ) {
    const star = document.createElementNS( SVGNS, 'circle' );
    star.setAttribute( 'cx', Math.floor( Math.random() * 2000 ) + 0.5 );
    star.setAttribute( 'cy', Math.floor( Math.random() * 2000 ) + 0.5 );
    star.setAttribute( 'r',  Math.random() * 1 );

    const col = Math.random() * 50 + 200;
    star.setAttribute( 'fill', `rgba( ${ col }, ${ col }, ${ col }, ${ Math.random() } )` );
    stars.appendChild( star );
  }

  let player = new Ship( { x: 200, y: 200, angle: 0 } );

  function update( dt ) {

    player.goalAngle = Math.atan2( mouseY - player.y, mouseX - player.x );
    player.update( dt );

    document.body.scrollTo( player.x - window.innerWidth / 2, player.y - window.innerHeight / 2 );

    // document.body.scrollLeft = player.x;
    // document.body.scrollTop = player.y;
  }


  //
  // Input and update loop
  //

  let mouseX = 0, mouseY = 0, mouseDown = false;
  document.onmousemove = onInput;
  document.ontouchmove = onInput;
  document.onmousedown  = ( e ) => { mouseDown = true; onInput( e ); }
  document.ontouchstart = ( e ) => { mouseDown = true; onInput( e ); }
  document.onmouseup  = ( e ) => mouseDown = false;
  document.ontouchend = ( e ) => mouseDown = false;
  function onInput( e ) {
    const event = e.touches ? e.touches[0] : e;
    mouseX = event.pageX;
    mouseY = event.pageY;
  }

  let lastTime = null;
  function animate( now ) {
    lastTime ??= now;   // for first call only
    update( now - lastTime );
    lastTime = now;

    requestAnimationFrame( animate );
  }
  requestAnimationFrame( animate );

</script>