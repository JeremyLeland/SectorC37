<link rel="stylesheet" href="style.css">

<body>
  <svg>
    <defs>
      <path id="ship" d="M 1 0 L -1 1 L -1 -1 Z" fill="green" stroke="black" vector-effect="non-scaling-stroke"></path>
    </defs>
    <g id="stars"></g>
    <use id="player" xlink:href="#ship"></use>
  </svg>
</body>

<script type="module">

  const SVGNS = 'http://www.w3.org/2000/svg';

  // Create starfield
  const stars = document.getElementById( 'stars' );
  for ( let i = 0; i < 100; i ++ ) {
    const star = document.createElementNS( SVGNS, 'circle' );
    star.setAttribute( 'cx', Math.floor( Math.random() * 1000 ) + 0.5 );
    star.setAttribute( 'cy', Math.floor( Math.random() * 1000 ) + 0.5 );
    star.setAttribute( 'r',  Math.random() * 1 );

    const col = Math.random() * 50 + 200;
    star.setAttribute( 'fill', `rgba( ${ col }, ${ col }, ${ col }, ${ Math.random() } )` );
    stars.appendChild( star );
  }

  let player = {
    x: 200, y: 200, angle: 0,
    size: 10,
    svg: document.getElementById( 'player' ),
  };

  function update( dt ) {
    // TODO: Does order make a difference here?
    player.svg.style.transform = `translate( ${ player.x }px, ${ player.y }px ) scale( ${ player.size } ) rotate( ${ player.angle }rad )`;
  }


  //
  // Input and update loop
  //

  let mouseDown = false;
  document.onmousemove = onInput;
  document.ontouchmove = onInput;
  document.onmousedown  = ( e ) => { mouseDown = true; onInput( e ); }
  document.ontouchstart = ( e ) => { mouseDown = true; onInput( e ); }
  document.onmouseup  = ( e ) => mouseDown = false;
  document.ontouchend = ( e ) => mouseDown = false;
  function onInput( e ) {
    const event = e.touches ? e.touches[0] : e;

    player.angle = Math.atan2( event.pageY - player.y, event.pageX - player.x );

    // if ( gameState == State.Playing ) {
    //   player.goalAngle = Math.atan2( event.pageY - player.y, event.pageX - player.x );
    // }
    // else if ( mouseDown ) {
    //   newGame();
    // }
  }

  let lastTime = null;
  function animate( now ) {
    lastTime ??= now;   // for first call only
    update( now - lastTime );
    lastTime = now;

    requestAnimationFrame( animate );
  }
  requestAnimationFrame( animate );

</script>