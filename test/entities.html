<link rel="stylesheet" href="../style.css">

<style>
  body { background-color: black;}

  .player {
    position: absolute;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 1px 0 1px 2px;
    border-color: transparent transparent transparent green;
  }

  .enemy {
    position: absolute;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 1px 0 1px 2px;
    border-color: transparent transparent transparent blue;
  }

  .rock {
    position: absolute;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 1;
    border-radius: 50%;
    border-color: brown;
  }
  
</style>

<body>

</body>

<script type="module">

  import { Entity } from '../src/entity.js';
  import { Ship } from '../src/ship.js';
  import { World } from '../src/world.js';
  import { Info } from '../info/info.js';

  let player = new Ship( Info.Player );
  player.div.className = 'player';

  const world = new World();
  for ( let i = 0; i < 5; i ++ ) {
    world.spawn( createRock() );
  }
  for ( let i = 0; i < 5; i ++ ) {
    world.spawn( createEnemy() );
  }
  world.spawn( player );

  function update( dt ) {

    player.goalAngle = Math.atan2( 
      document.body.scrollTop + mouseY - player.y, 
      document.body.scrollLeft + mouseX - player.x
    );
    
    const enemies = world.entities.filter( e => e != player && e instanceof Ship );
    enemies.forEach( enemy => enemy.think( player, world.entities ) );

    world.update( dt );
  }

  function createEnemy() {
    const enemy = new Ship( Info.Enemy );
    enemy.div.className = 'enemy';
    return enemy;
  }

  function createRock() {
    const rock = new Entity( Info.Rock );
    rock.div.className = 'rock';
    // rock.dAngle = 0.0005;
    return rock;
  }

  let mouseX = 0, mouseY = 0, mouseDown = false;
  document.onmousemove = onInput;
  document.ontouchmove = onInput;
  document.onmousedown  = ( e ) => { mouseDown = true; onInput( e ); }
  document.ontouchstart = ( e ) => { mouseDown = true; onInput( e ); }
  document.onmouseup  = ( e ) => mouseDown = false;
  document.ontouchend = ( e ) => mouseDown = false;
  function onInput( e ) {
    const event = e.touches ? e.touches[0] : e;
    mouseX = event.clientX;
    mouseY = event.clientY;
  }

  let lastTime = null;
  function animate( now ) {
    lastTime ??= now;   // for first call only
    update( now - lastTime );
    lastTime = now;

    requestAnimationFrame( animate );
  }
  requestAnimationFrame( animate );

</script>

