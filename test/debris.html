<link rel="stylesheet" href="../style.css">

<body>
  <svg id='svg'>
    <defs>
      <path id="debris" d="M 1 0 L -1 1 L -1 -1 Z" fill="green" stroke="black" vector-effect="non-scaling-stroke"></path>
    </defs>
    <!-- <use id="test" href="#debris" transform="translate( 100, 100 ) scale( 10, 5 )"></use> -->
  </svg>
</body>

<script>

  document.onmousedown = ( e ) => {
    explode( e.pageX, e.pageY );
  }

  function explode( cx, cy ) {
    for ( let i = 0; i < 50; i ++ ) {
      const debris = document.createElementNS( 'http://www.w3.org/2000/svg', 'use' );
      debris.setAttribute( 'href', '#debris' );
      
      const offset = Math.random() * 20;
      const angle = Math.random() * Math.PI * 2;
      const speed = 100 + offset;
      const cos = Math.cos( angle );
      const sin = Math.sin( angle );

      const x = cx + cos * offset;
      const y = cy + sin * offset;
      const dx = Math.cos( angle ) * speed;
      const dy = Math.sin( angle ) * speed;

      let anim = debris.animate(
        [
          // keyframes
          {
            opacity: '100%',
            transform: `translate( ${ x }px, ${ y }px ) rotate( ${ Math.random() * 100 - 50 }deg ) scale( 5, 2 )`
          },
          {
            opacity: '0%',
            transform: `translate( ${ x + dx }px, ${ y + dy }px ) rotate( ${ Math.random() * 800 - 400 }deg ) scale( 5, 2 )`
          },
        ],
        {
          // timing
          duration: 1000,
          iterations: 1,
          fill: 'forwards',
        }
      );

      anim.onfinish = () => debris.remove();

      svg.appendChild( debris );
    }
  }
  
</script>