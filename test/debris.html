<link rel="stylesheet" href="../style.css">

<style>
  body { cursor: crosshair; }
  .flame {
    animation: flame 1s linear 0s 1 forwards;
  }
  @keyframes flame {
    0%   { fill: white; }
    50%  { fill: orange; }
    100% { fill: gray; }
  }
</style>

<body>
  <svg id='svg'>
    <g id="flames" style="mix-blend-mode: screen;"></g>
    <g id="debris" fill="green" stroke="black"></g>
  </svg>
</body>

<script>
  const flames = document.getElementById( 'flames' );
  const debris = document.getElementById( 'debris' );

  document.onmousedown = ( e ) => {
    explode( e.pageX, e.pageY );
  }

  function explode( cx, cy ) {
    for ( let i = 0; i < 50; i ++ ) {
      const flame = getParticle( { cx: cx, cy: cy, size: 25, spread: 5, speed: 20 } );
      
      flame.animate(
        {
          transform: [ 'scale( 0 )', 'scale( 1 )' ],
          filter: [ 'blur( 1px )', 'blur( 10px )' ],
          fill: [ 'white', 'orange', 'gray' ],
        },
        {
          duration: 1000,
          iterations: 1,
          fill: 'forwards',
          composite: 'add'
        }
      )

      flames.appendChild( flame );
      debris.appendChild( getParticle( { cx: cx, cy: cy, size: 4, spread: 10, speed: 80 } ) );
    }
  }

  function getParticle( { cx, cy, size, spread, speed } ) {
    const part = document.createElementNS( 'http://www.w3.org/2000/svg', 'path' );
    const points = [ 
      [ rand25() *  size, 0 ],
      [ rand25() * -size, rand25() *  size ],
      [ rand25() * -size, rand25() * -size ],
    ].join( ' L ' );
    part.setAttribute( 'd', `M ${ points } Z` );
    
    const rand = rand25();
    const angle = Math.random() * Math.PI * 2;
    
    const cos = Math.cos( angle );
    const sin = Math.sin( angle );

    const x1 = cx + cos * spread * rand;
    const y1 = cy + sin * spread * rand;
    const x2 = x1 + cos * speed * rand;
    const y2 = y1 + sin * speed * rand;

    let anim = part.animate(
      [
        // keyframes
        {
          opacity: '100%',
          transform: `translate( ${ x1 }px, ${ y1 }px ) rotate( ${ Math.random() * 100 - 50 }deg )`
        },
        {
          opacity: '0%',
          transform: `translate( ${ x2 }px, ${ y2 }px ) rotate( ${ Math.random() * 800 - 400 }deg )`
        },
      ],
      {
        // timing
        duration: 1000,
        iterations: 1,
        fill: 'forwards',
      }
    );

    anim.onfinish = () => part.remove();

    return part;
  }

  function rand25() { return Math.random() + 0.25; }
  
</script>