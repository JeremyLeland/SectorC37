<link rel="stylesheet" href="../style.css">

<body>
  <svg id='svg'>
    <g id="debris" fill="green" stroke="black"></g>
  </svg>
</body>

<script>

  const debris = document.getElementById( 'debris' );

  document.onmousedown = ( e ) => {
    explode( e.pageX, e.pageY );
  }

  function explode( cx, cy ) {
    for ( let i = 0; i < 50; i ++ ) {
      const shard = document.createElementNS( 'http://www.w3.org/2000/svg', 'path' );
      shard.setAttribute( 'd', `M ${ Math.random() * 4 + 1 } 0 L ${ Math.random() * -4 - 1} ${ Math.random() * 4 + 1 } L ${ Math.random() * -4 - 1 } ${ Math.random() * -4 - 1 } Z` );
      
      const offset = Math.random() * 20;
      const angle = Math.random() * Math.PI * 2;
      const speed = 100 + offset;
      const cos = Math.cos( angle );
      const sin = Math.sin( angle );

      const x = cx + cos * offset;
      const y = cy + sin * offset;
      const dx = Math.cos( angle ) * speed;
      const dy = Math.sin( angle ) * speed;

      let anim = shard.animate(
        [
          // keyframes
          {
            opacity: '100%',
            transform: `translate( ${ x }px, ${ y }px ) rotate( ${ Math.random() * 100 - 50 }deg )`
          },
          {
            opacity: '0%',
            transform: `translate( ${ x + dx }px, ${ y + dy }px ) rotate( ${ Math.random() * 800 - 400 }deg )`
          },
        ],
        {
          // timing
          duration: 1000,
          iterations: 1,
          fill: 'forwards',
        }
      );

      anim.onfinish = () => shard.remove();

      debris.appendChild( shard );
    }
  }
  
</script>